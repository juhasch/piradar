# Configuration

PiRadar supports multiple configuration file formats for radar parameters. This chapter describes the available formats and configuration options.

## Configuration Formats

### YAML Format (Recommended)

The YAML format provides a clean, human-readable configuration structure using Pydantic validation.

**File Extension**: `.yaml` or `.yml`

**Example** (`radar_config.yaml`):

```yaml
start_frequency_Hz: 58000000000  # 58 GHz
stop_frequency_Hz: 63000000000   # 63 GHz
chirp_duration_s: 0.0005          # 500 microseconds
frame_length: 64                   # Number of chirps per frame
frame_duration_s: 0.1             # 100 milliseconds between frames
output_power: 31                   # Max power (0-31)
adc_sample_rate_Hz: 2000000       # 2 MHz ADC sampling
```

### Text Format (Legacy)

The text format is supported for compatibility with Infineon tools but is deprecated for new projects.

**File Extension**: `.txt`

This format contains register-level configuration and is typically generated by Infineon's radar configuration tool.

### JSON Format (Legacy)

JSON format is also supported for compatibility with existing tools.

**File Extension**: `.json`

## Configuration Parameters

### Frequency Settings

| Parameter | Type | Range | Description |
|-----------|------|-------|-------------|
| `start_frequency_Hz` | int | 58-63.5 GHz | FMCW start frequency in Hz |
| `stop_frequency_Hz` | int | 58-63.5 GHz | FMCW stop frequency in Hz |

**Constraints**:

- `start_frequency_Hz` must be less than `stop_frequency_Hz`
- Bandwidth (stop - start) cannot exceed 5.5 GHz

**Example**:

```yaml
start_frequency_Hz: 58000000000  # 58 GHz
stop_frequency_Hz: 63000000000   # 63 GHz (5 GHz bandwidth)
```

### Timing Parameters

| Parameter | Type | Range | Description |
|-----------|------|-------|-------------|
| `chirp_duration_s` | float | > 0 | Duration of a single chirp in seconds |
| `frame_length` | int | > 0 | Number of chirps per frame |
| `frame_duration_s` | float | > 0 | Time between frame starts in seconds |

**Example**:

```yaml
chirp_duration_s: 0.0005      # 500 Î¼s per chirp
frame_length: 64              # 64 chirps per frame
frame_duration_s: 0.1         # 10 frames per second
```

### Power Settings

| Parameter | Type | Range | Description |
|-----------|------|-------|-------------|
| `output_power` | int | 0-31 | TX power level (5-bit DAC) |

**Power Levels**:

- 0: Minimum power
- 31: Maximum power (approximately +4 dBm)

**Example**:

```yaml
output_power: 31  # Maximum transmit power
```

### ADC Settings

| Parameter | Type | Range | Description |
|-----------|------|-------|-------------|
| `adc_sample_rate_Hz` | int | 1-4000000 | ADC sampling rate in Hz |

**Recommended Values**:

- Short range (<5m): 1-2 MHz
- Medium range (5-10m): 2-3 MHz
- Long range (>10m): 3-4 MHz

**Example**:

```yaml
adc_sample_rate_Hz: 2000000  # 2 MHz sampling
```

## Using Configuration Files

### Command Line Interface

```bash
# Monitor with custom configuration
piradar monitor --config radar_config.yaml

# Record data with custom configuration
piradar record --config radar_config.yaml --frames 100

# Publish data with custom configuration
piradar publish --config radar_config.yaml
```

### Python API

```python
from piradar.hw import BGT60TR13C
from piradar.config import RadarConfig

# Load configuration from YAML
config = RadarConfig.read_yaml("radar_config.yaml")

# Apply configuration to radar
with BGT60TR13C() as radar:
    radar.configure(config)
    radar.start()
    # ... collect data
```

### Create Configuration Programmatically

```python
from piradar.config import RadarConfig

# Create configuration object
config = RadarConfig(
    start_frequency_Hz=58_000_000_000,
    stop_frequency_Hz=63_000_000_000,
    chirp_duration_s=0.0005,
    frame_length=64,
    frame_duration_s=0.1,
    output_power=31,
    adc_sample_rate_Hz=2_000_000
)

# Save to YAML
with open("my_config.yaml", "w") as f:
    f.write(config.model_dump_yaml())
```

## Configuration Validation

The YAML configuration format uses Pydantic for automatic validation:

- **Type checking**: Ensures correct data types
- **Range validation**: Checks values are within hardware limits
- **Constraint validation**: Validates relationships between parameters

**Example validation errors**:

```python
# Invalid: start >= stop
config = RadarConfig(
    start_frequency_Hz=63_000_000_000,
    stop_frequency_Hz=58_000_000_000,  # Error!
    ...
)
# Raises: ValueError: start_frequency_Hz must be less than stop_frequency_Hz

# Invalid: bandwidth too large
config = RadarConfig(
    start_frequency_Hz=58_000_000_000,
    stop_frequency_Hz=64_000_000_000,  # Error!
    ...
)
# Raises: ValueError: Frequency bandwidth exceeds maximum (5.5 GHz)
```

## Example Configurations

### Short Range Detection (<5m)

```yaml
# Optimized for close targets with high resolution
start_frequency_Hz: 60000000000
stop_frequency_Hz: 63000000000
chirp_duration_s: 0.0003
frame_length: 128
frame_duration_s: 0.05
output_power: 20
adc_sample_rate_Hz: 2000000
```

### Medium Range Detection (5-10m)

```yaml
# Balanced configuration for general use
start_frequency_Hz: 58000000000
stop_frequency_Hz: 63000000000
chirp_duration_s: 0.0005
frame_length: 64
frame_duration_s: 0.1
output_power: 31
adc_sample_rate_Hz: 2500000
```

### Long Range Detection (>10m)

```yaml
# Optimized for distant targets
start_frequency_Hz: 58000000000
stop_frequency_Hz: 63500000000
chirp_duration_s: 0.001
frame_length: 32
frame_duration_s: 0.2
output_power: 31
adc_sample_rate_Hz: 4000000
```

## Default Configuration

If no configuration file is specified, PiRadar uses default settings optimized for general-purpose detection:

```yaml
start_frequency_Hz: 58000000000
stop_frequency_Hz: 63000000000
chirp_duration_s: 0.0005
frame_length: 64
frame_duration_s: 0.1
output_power: 31
adc_sample_rate_Hz: 2000000
```

## Register Map Configuration

For advanced users who need direct register-level control, see the [Register Map Documentation](register-map) which provides:

- Complete register-level access
- Field-by-field configuration
- Hardware-level parameter control
- Direct access via the adaptive controller

## Troubleshooting

### Configuration Not Applied

If the radar doesn't respond to configuration changes:

1. Check file permissions and path
2. Verify YAML syntax (use a YAML validator)
3. Enable debug logging: `--log-level DEBUG`
4. Check validation errors in output

### Invalid Values

If you encounter validation errors:

1. Check parameter ranges against hardware limits
2. Verify frequency constraints (58-63.5 GHz, max 5.5 GHz bandwidth)
3. Ensure timing parameters are positive
4. Check ADC sample rate is within 1-4 MHz

### Performance Issues

If the radar performs poorly:

1. Adjust `output_power` for your range requirements
2. Match `adc_sample_rate_Hz` to your range needs
3. Optimize `frame_duration_s` for your frame rate requirements
4. Consider bandwidth vs. resolution trade-offs

## See Also

- [Register Map Documentation](register-map) - Low-level register access
- [Adaptive Radar](adaptive-radar) - Dynamic parameter control
- [Quick Start](quickstart) - Basic usage examples

